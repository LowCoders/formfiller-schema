{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "title": "Validation Schema",
  "description": "Common validation rule definitions",
  "definitions": {
    "ErrorTarget": {
      "oneOf": [
        {
          "type": "string",
          "enum": ["currentField", "allTargetFields"]
        },
        {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Array of field paths where the error should be displayed"
        }
      ]
    },
    "ValidationRuleBase": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string",
          "description": "Custom error message"
        },
        "errorTarget": {
          "$ref": "#/definitions/ErrorTarget",
          "description": "Where to display the validation error. Default: 'currentField' for field-level rules, 'allTargetFields' for form-level rules"
        },
        "when": {
          "description": "Conditional expression that determines when this rule should be applied"
        }
      }
    },
    "ValidationRule": {
      "type": "object",
      "oneOf": [
        {
          "type": "object",
          "allOf": [
            { "$ref": "#/definitions/ValidationRuleBase" },
            {
              "properties": {
                "type": {
                  "enum": ["required", "email", "pattern", "custom", "numeric", "arrayLength"]
                }
              },
              "required": ["type"]
            }
          ]
        },
        {
          "type": "object",
          "allOf": [
            { "$ref": "#/definitions/ValidationRuleBase" },
            {
              "properties": {
                "type": {
                  "enum": ["stringLength", "range"]
                },
                "min": {
                  "type": "number"
                },
                "max": {
                  "type": "number"
                }
              },
              "required": ["type"]
            }
          ]
        },
        {
          "type": "object",
          "allOf": [
            { "$ref": "#/definitions/ValidationRuleBase" },
            {
              "properties": {
                "type": {
                  "const": "compare"
                },
                "comparisonTarget": {
                  "type": "string"
                },
                "comparisonType": {
                  "enum": ["==", "!=", ">", "<", ">=", "<="]
                }
              },
              "required": ["type", "comparisonTarget"]
            }
          ]
        },
        {
          "type": "object",
          "allOf": [
            { "$ref": "#/definitions/ValidationRuleBase" },
            {
              "properties": {
                "type": {
                  "enum": [
                    "equals",
                    "notEquals",
                    "greaterThan",
                    "lessThan",
                    "sumEquals",
                    "percentageSum",
                    "dateInRange",
                    "atLeastOne"
                  ],
                  "description": "CrossField validator types - type IS the callback name"
                },
                "targetFields": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Field paths to validate together"
                }
              },
              "required": ["type", "targetFields"]
            }
          ]
        }
      ]
    },
    "FormPreferences": {
      "type": "object",
      "properties": {
        "addSaveBtn": {
          "type": "boolean",
          "description": "Automatically add save button at the end of form"
        },
        "saveLimit": {
          "type": ["number", "null"],
          "description": "Maximum number of saves allowed (quota)"
        },
        "saveUrl": {
          "type": "string",
          "description": "Optional custom save endpoint URL"
        },
        "computedRuleResults": {
          "enum": ["none", "score", "detailed"],
          "description": "How to display computed validation results"
        },
        "storeComputedResults": {
          "type": "boolean",
          "description": "Whether to store computed results in form data"
        },
        "showErrorsOnFormLevel": {
          "type": "boolean",
          "default": true,
          "description": "Show validation errors in a summary accordion at the top of the form"
        }
      }
    }
  }
}
